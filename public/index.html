<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor</title>
    <link rel='shortcut icon' href='favcon.png' type='image/x-icon'/ >
    
    <script src="jquery/dist/jquery.min.js"></script>
    
    <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="bootstrap/dist/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="bootstrap/dist/js/bootstrap.min.js"></script>
    
	
    <link href="https://cdn.datatables.net/plug-ins/1.10.7/integration/bootstrap/3/dataTables.bootstrap.css" rel="stylesheet" />
    <script src="https://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.7/integration/bootstrap/3/dataTables.bootstrap.js"></script>

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="row">
        <div class="col-xs-4">
            <div class="wrapper">
                <form class="form-horizontal">
                    <div class="input-group">
                        <input type="text" id="search-input" class="form-control" placeholder="Search for...">
                        <span class="input-group-btn">
                            <button class="btn btn-default btn-search" type="button"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                        </span>
                    </div>
                </form>
            </div>

			<ul class="menu">
				<li class="active" el="processes">Processess</li>
				<li el="system">System</li>
				<li el="terminal">Terminal</li>
				<li el="status">Status</li>
			</ul>
        </div>
        <div class="col-xs-8">
            <div class="wrapper tab processes">
                <table id="process_table" class="table table-condensed" style="color: gray;overflow-y: auto;">
                    <thead>
                        <tr>
                            <th>PID</th>
                            <th>Command</th> 
                            <th>CPU</th>
                            <th>RAM</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
			<div class="wrapper tab system">
				<h3 id="os">OS: Linux - Ubuntu</h3>
				<h3 id="os-version">Version: 14.0.2 LTS</h3>
			</div>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
		var formatBytes = function(bytes, precision) {
			var kilobyte = 1024;
			var megabyte = kilobyte * 1024;
			var gigabyte = megabyte * 1024;
			var terabyte = gigabyte * 1024;

			if ((bytes >= 0) && (bytes < kilobyte)) {
				return bytes + ' B   ';
			} else if ((bytes >= kilobyte) && (bytes < megabyte)) {
				return (bytes / kilobyte).toFixed(precision) + ' KB  ';
			} else if ((bytes >= megabyte) && (bytes < gigabyte)) {
				return (bytes / megabyte).toFixed(precision) + ' MB  ';
			} else if ((bytes >= gigabyte) && (bytes < terabyte)) {
				return (bytes / gigabyte).toFixed(precision) + ' GB  ';
			} else if (bytes >= terabyte) {
				return (bytes / terabyte).toFixed(precision) + ' TB  ';
			} else {
				return bytes + ' B   ';
			}
		};


		var table = $('#process_table').DataTable( {
				ajax: '/process_info',
				columns: [
					{ data: 0 },
					{ data: 1 },
					{ data: 2 },
					{ data: 3 }
				],
				//bFilter: false,
				createdRow: function ( row, data, index ) {
					$('td', row).eq(3).attr('data-sort', $('td', row).eq(3).html());
					$('td', row).eq(3).html(formatBytes($('td', row).eq(3).html()));
					$('td', row).eq(2).html(parseInt($('td', row).eq(3).html()).toFixed(2));
				}
			});
			console.log(table);

		setInterval( function () {
			console.log("refreshing data");
			table.ajax.reload(null, false);
		}, 10000 );

		$.ajax({url: "sys_info", success: function(result){
			$('#os').html("Operating System: " + result.os);
			$('#os-version').html("Version: " + result.version);
		}});


		$('#search-input').keyup(function(){
			  table.search($(this).val()).draw() ;
		})


		$('.menu li').click(function(){
			$('.menu li').removeClass("active");
			$(this).addClass("active");		
			$(".tab").hide();
			$(".tab." + $(this).attr('el')).show();
		});
/*
        var socket = io();

		socket.emit('ready');*/
    </script>
</body>
</html>
